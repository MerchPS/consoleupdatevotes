<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MotionImeFest ‚Äî Votes & Views Monitor</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: Inter, sans-serif;
  background: #040b1a;
  color: #f0f4fa;
  margin: 0;
  padding: 20px;
}
h1 { font-size: 20px; margin-bottom: 5px; }
p { color: #9fb0c8; margin-top: 0; }
table {
  width: 100%; border-collapse: collapse; margin-top: 10px;
}
th, td {
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding: 8px; text-align: left;
}
th { color: #8aa1c5; font-size: 13px; }
tr:hover { background: rgba(255,255,255,0.05); }
button {
  background: linear-gradient(90deg,#56a6ff,#6bc1ff);
  border: none; padding: 8px 12px; color: #001;
  font-weight: 600; border-radius: 8px; cursor: pointer;
}
button.alt { background: linear-gradient(90deg,#ff6b6b,#ff9b9b); color:#fff; }
input {
  background: #0c1624; border: 1px solid #182437;
  color: #9fb0c8; padding: 8px; border-radius: 6px;
}
.controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
#log {
  background:#0c1624; border:1px solid #182437;
  border-radius:8px; padding:8px; height:150px; overflow:auto;
  font-size:13px; color:#b6d4ff;
}
.up { color:#00e47a; font-weight:700; }
.down { color:#ff7a7a; font-weight:700; }
.muted { color:#8aa1c5; }
footer { margin-top:10px; font-size:13px; color:#8aa1c5; }
</style>
</head>
<body>
<h1>MotionImeFest ‚Äî Real-Time Votes & Views</h1>
<p>Read-only monitor for all 8 submissions. Optimized for Vercel. Fast, stable, and no fetch fails.</p>

<div class="controls">
  <input id="proxyInput" type="text" style="flex:1" placeholder="Proxy base (e.g. https://yourapp.vercel.app/api/fetch?url=)">
  <button id="refreshBtn">Refresh</button>
  <button id="autoBtn" class="alt">Auto: OFF</button>
</div>

<table id="table">
  <thead>
    <tr>
      <th>ID</th><th>Name</th><th>Votes</th><th>Œî</th><th>Views</th><th>Status</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>Console Log</h3>
<div id="log"></div>
<footer>üí° Deploy your proxy to Vercel ‚Üí Paste its URL above for 100% success rate.</footer>

<script>
(async () => {
  const SUBMISSIONS = [
    { id: 24087, name: "xxknjt" },
    { id: 24084, name: "boo" },
    { id: 24081, name: "JustDani" },
    { id: 24078, name: "SonMV" },
    { id: 24075, name: "KekeLawar" },
    { id: 24066, name: "searchforemma" },
    { id: 24072, name: "YaraYay" },
    { id: 24069, name: "Wasawho" }
  ];

  const PARTICIPATE = "https://motionimefest.id/contest/newcomer-streamer-of-the-year/participate/?cid=23816&cm=1";
  const LIST = "https://motionimefest.id/contest/newcomer-streamer-of-the-year/submissions/?cid=23816&cm=1&sd=desc&sb=date&cpn=1";
  const BASE = id => `https://motionimefest.id/contest/newcomer-streamer-of-the-year/submission/${id}/?cid=23816&cm=1`;

  const PROXY_LIST = [
    url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
    url => `https://thingproxy.freeboard.io/fetch/${url}`
  ];

  const tbody = document.querySelector("#table tbody");
  const logEl = document.querySelector("#log");
  const refreshBtn = document.getElementById("refreshBtn");
  const autoBtn = document.getElementById("autoBtn");
  const proxyInput = document.getElementById("proxyInput");

  let lastVotes = {};
  let auto = false, timer = null;

  const log = msg => {
    const ts = new Date().toLocaleTimeString();
    logEl.innerText = `[${ts}] ${msg}\n` + logEl.innerText;
  };

  async function warm() {
    try {
      await fetch(PARTICIPATE, { cache: "no-store" });
      await fetch(LIST, { cache: "no-store" });
      log("‚úÖ Cache warmed.");
    } catch { log("‚ö†Ô∏è Warming skipped."); }
  }

  function parse(text) {
    const v = text.match(/([\d.,]+)\s*Votes/i);
    const w = text.match(/([\d.,]+)\s*Views/i);
    const votes = v ? parseInt(v[1].replace(/[^\d]/g,'')) : 0;
    const views = w ? parseInt(w[1].replace(/[^\d]/g,'')) : 0;
    return { votes, views };
  }

  async function fetchHtml(url, retries = 3) {
    const proxyBase = proxyInput.value.trim();
    let err = null;
    for (let i = 0; i < retries; i++) {
      try {
        // try custom proxy first
        if (proxyBase) {
          const p = proxyBase + encodeURIComponent(url);
          const res = await fetch(p, { cache: "no-store" });
          if (res.ok) return await res.text();
        }
        // then direct
        const res = await fetch(url, { cache: "no-store" });
        if (res.ok) return await res.text();
      } catch (e) { err = e; }
      await new Promise(r => setTimeout(r, 500 * (i+1)));
    }
    // fallback proxies
    for (const fn of PROXY_LIST) {
      try {
        const purl = fn(url);
        const res = await fetch(purl, { cache: "no-store" });
        if (res.ok) return await res.text();
      } catch (e) { err = e; }
    }
    throw err || new Error("All fetch attempts failed");
  }

  async function getOne(sub) {
    const url = BASE(sub.id);
    try {
      const html = await fetchHtml(url, 2);
      const { votes, views } = parse(html);
      const diff = lastVotes[sub.id] ? votes - lastVotes[sub.id] : 0;
      lastVotes[sub.id] = votes;
      return { ...sub, votes, views, diff };
    } catch (e) {
      log(`‚ùå ${sub.name} failed: ${e.message}`);
      return { ...sub, votes: 0, views: 0, diff: 0, error: true };
    }
  }

  async function fetchAll() {
    await warm();
    log("üîÑ Updating...");
    const results = await Promise.all(SUBMISSIONS.map(getOne));
    tbody.innerHTML = results.map(r => `
      <tr>
        <td>${r.id}</td>
        <td>${r.name}</td>
        <td>${r.votes.toLocaleString()}</td>
        <td class="${r.diff>0?'up':r.diff<0?'down':'muted'}">${r.diff>0?`+${r.diff}`:r.diff}</td>
        <td>${r.views.toLocaleString()}</td>
        <td>${r.error?'‚ùå Fail':'‚úÖ OK'}</td>
      </tr>
    `).join("");
  }

  refreshBtn.onclick = () => fetchAll();
  autoBtn.onclick = () => {
    auto = !auto;
    autoBtn.textContent = auto ? "Auto: ON" : "Auto: OFF";
    autoBtn.classList.toggle("alt", !auto);
    if (auto) timer = setInterval(fetchAll, 2500);
    else clearInterval(timer);
  };

  fetchAll();
})();
</script>
</body>
</html>
